<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><title>OpenSCADAWiki : Doc/JavaLikeCalc</title>



  
<meta name="robots" content="noindex, nofollow">
  <meta http-equiv="content-type" content="text/html; charset=windows-1251">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <link rel="stylesheet" type="text/css" href="about_ru_files/wakkaprint.css"></head><body>

<div class="header">
	<h1>
  OpenSCADAWiki : <a href="http://diyaorg.dp.ua/oscadawiki/wakka.php?wakka=TextSearch?phrase=Doc%2FJavaLikeCalc">Doc/JavaLikeCalc</a> 
	</h1>
</div>

<div class="pageBefore"><img src="about_ru_files/z.gif" alt="" style="display: block;" align="top" border="0" height="1" width="1"></div><div class="page">
<a name="h101-1"></a><h1>Модуль подсистемы “Контроллеры” &lt;JavaLikeCalc&gt;</h1>
<br>
<table class="usertable" border="1">
<tbody><tr class="userrow"><td class="usercell"><em>Модуль:</em></td><td class="usercell">JavaLikeCalc</td></tr>
<tr class="userrow"><td class="usercell"><em>Имя:</em></td><td class="usercell">Вычислитель на&nbsp;Java-подобном языке.</td></tr>
<tr class="userrow"><td class="usercell"><em>Тип:</em></td><td class="usercell">Контроллер</td></tr>
<tr class="userrow"><td class="usercell"><em>Источник:</em></td><td class="usercell">cntr_JavaLikeCalc.so</td></tr>
<tr class="userrow"><td class="usercell"><em>Версия:</em></td><td class="usercell">0.9.5</td></tr>
<tr class="userrow"><td class="usercell"><em>Автор:</em></td><td class="usercell">Роман Савоченко</td></tr>
<tr class="userrow"><td class="usercell"><em>Описание:</em></td><td class="usercell">Предоставляет
основанные на&nbsp;java подобном языке вычислитель и&nbsp;движок
библиотек. Пользователь может создавать и&nbsp;модифицировать функции
и&nbsp;библиотеки.</td></tr>
<tr class="userrow"><td class="usercell"><em>Лицензия:</em></td><td class="usercell">GPL</td></tr>
</tbody></table>
<br>
<!--notypo--><fieldset><legend><strong> Оглавление документа   </strong></legend><div class="toc1"><a href="#h101-2">Введение</a></div><div class="toc1"><a href="#h101-3">1 Java-подобный язык</a></div><div class="toc2"><a href="#h101-4">1.1 Элементы языка</a></div><div class="toc2"><a href="#h101-5">1.2 Операции языка</a></div><div class="toc2"><a href="#h101-6">1.3 Встроенные функции языка</a></div><div class="toc2"><a href="#h101-7">1.4 Операторы языка</a></div><div class="toc2"><a href="#h101-8">1.5 Примеры программы на&nbsp;языке</a></div><div class="toc1"><a href="#h101-9">2 Контроллер и&nbsp;его конфигурация</a></div><div class="toc1"><a href="#h101-10">3 Параметр контроллера и&nbsp;его конфигурация</a></div><div class="toc1"><a href="#h101-11">4 Библиотеки функций модуля</a></div><div class="toc1"><a href="#h101-12">5 Пользовательские функции модуля</a></div></fieldset><!--/notypo--><br>
<a name="h101-2"></a><h2>Введение</h2>
Модуль контроллера <em>JavaLikeCalc</em>
предоставляет в&nbsp;систему механизм создания функций и&nbsp;их
библиотек на&nbsp;Java-подобном языке. Описание функции
на&nbsp;Java-подобном языке сводится к&nbsp;обвязке параметров функции
алгоритмом. Кроме этого, модуль наделен функциями непосредственных
вычислений путём создания вычислительных контроллеров.<br>
<br>
Непосредственные вычисления обеспечиваются созданием контроллера
и&nbsp;связыванием его&nbsp;с&nbsp;функцией этого же&nbsp;модуля.
Для&nbsp;связанной функции создаётся кадр значений, над&nbsp;которым
и&nbsp;выполняются периодические вычисления.<br>
<br>
Параметры функции могут свободно создаваться, удаляться
или&nbsp;модифицироваться. Текущая версия модуля поддерживает
до&nbsp;255 параметров функции в&nbsp;сумме с&nbsp;внутренними
переменными. Вид&nbsp;редактора функций показан на&nbsp;рис.1.<br>
<br>
<div style="text-align: center;"><img src="about_ru_files/wakka_002.jpeg" alt="Вид редактора функций (127&nbsp;Кб)" title="Вид редактора функций (127&nbsp;Кб)" height="702" width="890"><br>
Рис.1. Вид&nbsp;редактора функций.</div><br>
<br>
После любого изменения программы или&nbsp;конфигурации параметров
выполняется перекомпиляция программы с&nbsp;упреждением связанных
с&nbsp;функцией объектов значений TValCfg. Компилятор языка построен
с&nbsp;использованием известного генератора грамматики «Bison», который
совместим с&nbsp;не менее известной утилитой Yacc.<br>
<br>
Язык использует неявное определение локальных переменных, которое
заключается в&nbsp;определении новой переменной в&nbsp;случае
присваивания ей&nbsp;значения. Причём, тип&nbsp;локальной переменной
устанавливается в&nbsp;соответствии с&nbsp;типом присваиваемого
значения. Например выражение &lt;Qr=Q0*Pi+0.01;&gt; определит
переменную Qr&nbsp;с типом переменной Q0.<br>
<br>
В&nbsp;работе с&nbsp;различными типами данных язык использует механизм
автоматического приведения типов в&nbsp;местах где&nbsp;подобное
приведение является целесообразным.<br>
<br>
Для&nbsp;комментирования участков кода в&nbsp;языке предусмотрены
символы «//». Всё что&nbsp;идёт после данных символов до&nbsp;конца
строки игнорируется компилятором.<br>
<br>
В&nbsp;процессе генерации кода, компилятор языка производит оптимизацию
по&nbsp;константам и&nbsp;приведение типов констант к&nbsp;требуемому
типу. Под&nbsp;оптимизацией констант подразумевается выполнение
вычислений в&nbsp;процессе построения кода над&nbsp;двумя константами
и&nbsp;вставка результата в&nbsp;код. Например выражение
&lt;y=pi*10;&gt; свернётся в&nbsp;простое присваивание
&lt;y=31.4159;&gt;. Под&nbsp;приведением типов констант
к&nbsp;требуемому типу подразумевается формирования в&nbsp;коде
константы, которая исключает приведение типа в&nbsp;процессе
исполнения. Например выражение &lt;y=x*10&gt;, в&nbsp;случае
вещественного типа переменной x, преобразуется в&nbsp;&lt;y=x*10.0&gt;.<br>
<br>
Язык поддерживает вызовы внешних и&nbsp;внутренних функций.
Имя&nbsp;любой функции, вообще, воспринимается как&nbsp;символ,
проверка на&nbsp;принадлежность которого, к&nbsp;той или&nbsp;иной
категории, производится в&nbsp;следующем порядке:<br>
<ul><li> ключевые слова;
</li><li> константы;
</li><li> встроенные функции;
</li><li> внешние функции;
</li><li> уже&nbsp;зарегистрированные символы переменных;
</li><li> новые атрибуты системных параметров;
</li><li> новые параметры функции;
</li><li> новая автоматическая переменная. </li></ul>
<br>
Вызов внешней функции, как&nbsp;и&nbsp;атрибута системного параметра,
записывается как&nbsp;адрес к&nbsp;объекту динамического дерева
объектной модели системы OpenSCADA в&nbsp;виде:
&lt;DAQ.JavaLikeCalc.lib_techApp.klapNotLin&gt;.<br>
<a name="h101-3"></a><h2>1 Java-подобный язык</h2><a name="h101-4"></a><h3>1.1 Элементы языка</h3>
<em>Ключевые слова:</em> if, else, true, false.<br>
<em>Постоянные:</em><br>
<ul><li> десятичные: цифры <span class="nobr">0–9</span> (12,111, 678);
</li><li> восьмеричные: цифры <span class="nobr">0–7</span> ( 012, 011, 076);
</li><li> шестнадцатеричные: цифры <span class="nobr">0–9</span>, буквы a-f или&nbsp;A-F (0x12, 0XAB);
</li><li> вещественные: 345.23, 2.1e5, 3.4E-5, 3e6;
</li><li> логические: true, false;
</li><li> строковые: «hello».</li></ul>
<em>Типы переменных:</em><br>
<ul><li> целое: -2<sup>31</sup>...2<sup>31</sup>;
</li><li> вещественное: 3.4 * 10<sup>308</sup>;
</li><li> логическое: false, true;
</li><li> строка: длина любая но&nbsp;без перехода на&nbsp;другую строку.</li></ul>
<em>Встроенные константы:</em> pi&nbsp;= 3.14159265, e&nbsp;= 2.71828182, EVAL_BOOL(2), EVAL_INT(-2147483647), EVAL_REAL(-3.3E308), EVAL_STR("&lt;EVAL&gt;")<br>
<em>Атрибуты параметров системы OpenSCADA (по объектной модели).</em><br>
<em>Функции объектной модели системы OpenSCADA.</em><br>
<a name="h101-5"></a><h3>1.2 Операции языка</h3>
Операции поддерживаемые языком представлены в&nbsp;таблице ниже.
Приоритет операций уменьшается с&nbsp;верху вниз. Операции
с&nbsp;одинаковым приоритетом входят в&nbsp;одну цветовую группу.<br>
<!--notypo--> <table bgcolor="#fffff0" border="1" cellspacing="0"> 
<tbody><tr align="center" bgcolor="#83d8ff"><td><b>Символ</b></td><td><b>Описание</b></td></tr> 
<tr bgcolor="#ffffc0"><td>()</td><td>Вызов функции.</td></tr> 
<tr><td>{}</td><td>Программные блоки.</td></tr>
<tr bgcolor="#ffffc0"><td>-</td><td>Унарный минус.</td></tr> 
<tr bgcolor="#ffffc0"><td>!</td><td>Логическое отрицание.</td></tr> 
<tr bgcolor="#ffffc0"><td>~</td><td>Побитовое отрицание.</td></tr> 
<tr><td>*</td><td>Умножение.</td></tr>
<tr><td>/</td><td>Деление.</td></tr>
<tr><td>%</td><td>Остаток от целочисленного деления.</td></tr>
<tr bgcolor="#ffffc0"><td>+</td><td>Сложение</td></tr> 
<tr bgcolor="#ffffc0"><td>-</td><td>Вычитание</td></tr> 
<tr><td>&gt;</td><td>Больше</td></tr>
<tr><td>&gt;=</td><td>Больше или равно</td></tr>
<tr><td>&lt;</td><td>Меньше</td></tr>
<tr><td>&lt;=</td><td>Меньше или равно</td></tr>
<tr><td>==</td><td>Равно</td></tr>
<tr><td>!=</td><td>Неравно</td></tr>
<tr bgcolor="#ffffc0"><td>|</td><td>Поразрядное «ИЛИ»</td></tr> 
<tr bgcolor="#ffffc0"><td>&amp;</td><td>Поразрядное «И»</td></tr>
<tr bgcolor="#ffffc0"><td>^</td><td>Поразрядное «Исключающее ИЛИ»</td></tr>
<tr><td>&amp;&amp;</td><td>Логический «И»</td></tr>
<tr bgcolor="#ffffc0"><td>||</td><td>Логический «ИЛИ»</td></tr>
<tr><td>?:</td><td>Условная операция (i=(i&lt;0)?0:i;)</td></tr>
<tr bgcolor="#ffffc0"><td>=</td><td>Присваивание.</td></tr>
<tr bgcolor="#ffffc0"><td>+=</td><td>Присваивание с сложением.</td></tr>
<tr bgcolor="#ffffc0"><td>-=</td><td>Присваивание с вычитанием.</td></tr>
<tr bgcolor="#ffffc0"><td>*=</td><td>Присваивание с умножением.</td></tr>
<tr bgcolor="#ffffc0"><td>/=</td><td>Присваивание с делением.</td></tr>
</tbody></table> <!--/notypo--><br>
<a name="h101-6"></a><h3>1.3 Встроенные функции языка</h3>
Для&nbsp;обеспечения высокой скорости работы в&nbsp;математических
вычислениях модуль предоставляет встроенные математические функции,
которые вызываются на&nbsp;уровне команд виртуальной машины. Встроенные
математические функции:<br>
<ul><li> sin(x) — синус x;
</li><li> cos(x) — косинус x;
</li><li> tan(x) — тангенс x;
</li><li> sinh(x) — синус гиперболический от&nbsp;x;
</li><li> cosh(x) — косинус гиперболический от&nbsp;x;
</li><li> tanh(x) — тангенс гиперболический от&nbsp;x;
</li><li> asin(x) — арксинус от&nbsp;x;
</li><li> acos(x) — арккосинус от&nbsp;x;
</li><li> atan(x) — арктангенс от&nbsp;x;
</li><li> rand(x) — случайное число от&nbsp;0 до&nbsp;x;
</li><li> lg(x) — десятичный логарифм от&nbsp;x;
</li><li> ln(x) — натуральный логарифм от&nbsp;x;
</li><li> exp(x) — экспонента от&nbsp;x;
</li><li> pow(x,y) — возведение x&nbsp;в степень y;
</li><li> sqrt(x) — корень квадратный от&nbsp;x;
</li><li> abs(x) — абсолютное значение от&nbsp;x;
</li><li> sign(x) — знак числа x;
</li><li> ceil(x) — округление числа x&nbsp;до большего целого;
</li><li> floor(x) — округление числа x&nbsp;до меньшего целого.</li></ul>
<a name="h101-7"></a><h3>1.4 Операторы языка</h3>
Языком модуля поддерживаются два&nbsp;типа условных операторов. Первый
это&nbsp;условный оператор для&nbsp;использования внутри выражения,
второй – глобальный. <br>
<br>
Условный оператор для&nbsp;использования внутри выражения строится
на&nbsp;операциях «?» и&nbsp;«:». В&nbsp;качестве примера можно
записать следующее практическое выражение
&lt;st_open=(pos&gt;=100)?true:false;&gt; что&nbsp;читается
как&nbsp;«Если переменная pos&nbsp;больше или&nbsp;равна 100
то&nbsp;переменной st_open присваивается значение true иначе false.<br>
<br>
Глобальное условие строится на&nbsp;основе ключевых слов «if»
и&nbsp;«else». В&nbsp;качестве примера можно привести тоже выражение,
но&nbsp;записанное другим способом &lt;if(pos&gt;100) st_open=true;
else st_open=false;&gt;. Как&nbsp;видно выражение записано
по&nbsp;другому но&nbsp;читается также.<br>
<a name="h101-8"></a><h3>1.5 Примеры программы на&nbsp;языке</h3>
Приведём несколько примеров программ на&nbsp;Java-подобном языке:<br>
<br>
<!--notypo--><div class="code"><code><font color="#000000">
//Модель хода исполнительного механизма шарового крана<br>if( !(st_close &amp;&amp; !com) &amp;&amp; !(st_open &amp;&amp; com) )<br>{<br>&nbsp;&nbsp;tmp_up=(pos&gt;0&amp;&amp;pos&lt;100)?0:(tmp_up&gt;0&amp;&amp;lst_com==com)?tmp_up-1./frq:t_up;<br>&nbsp;&nbsp;pos+=(tmp_up&gt;0)?0:(100.*(com?1.:-1.))/(t_full*frq);<br>&nbsp;&nbsp;pos=(pos&gt;100)?100:(pos&lt;0)?0:pos;<br>&nbsp;&nbsp;st_open=(pos&gt;=100)?true:false;<br>&nbsp;&nbsp;st_close=(pos&lt;=0)?true:false;<br>&nbsp;&nbsp;lst_com=com;<br>}</font>
</code></div><!--/notypo--><br>
<br>
<!--notypo--><div class="code"><code><font color="#000000">
//Модель клапана<br>Qr=Q0+Q0*Kpr*(Pi-1)+0.01;<br>Sr=(S_kl1*l_kl1+S_kl2*l_kl2)/100.;<br>Ftmp=(Pi&gt;2.*Po)?Pi*pow(Q0*0.75/Ti,0.5):(Po&gt;2.*Pi)?Po*pow(Q0*0.75/To,0.5):pow(abs(Q0*(pow(Pi,2)-pow(Po,2))/Ti),0.5);<br>Fi-=(Fi-7260.*Sr*sign(Pi-Po)*Ftmp)/(0.01*lo*frq);<br>Po+=0.27*(Fi-Fo)/(So*lo*Q0*frq);<br>Po=(Po&lt;0)?0:(Po&gt;100)?100:Po;<br>To+=(abs(Fi)*(Ti*pow(Po/Pi,0.02)-To)+(Fwind+1)*(Twind-To)/Riz)/(Ct*So*lo*Qr*frq);</font>
</code></div><!--/notypo--><br>
<a name="h101-9"></a><h2>2 Контроллер и&nbsp;его конфигурация</h2>
Контроллер этого модуля связывается с&nbsp;функциями из&nbsp;библиотек
построенных с&nbsp;его помощью, для&nbsp;обеспечения непосредственных
вычислений. Для&nbsp;предоставления вычисленных данных в&nbsp;систему
OpenSCADA, в&nbsp;контроллере могут создаваться параметры. Пример
вкладки конфигурации контроллера данного типа изображен на&nbsp;рис.2.<br>
<br>
<div style="text-align: center;"><img src="about_ru_files/wakka_004.jpeg" alt="Формы конфигурации контроллера. (98&nbsp;Кб)" title="Формы конфигурации контроллера. (98&nbsp;Кб)" height="860" width="758"><br>
Рис.2. Вкладка конфигурации контроллера.</div><br>
<br>
С&nbsp;помощью этой вкладки можно установить:<br>
<ul><li> Состояние контроллера, а&nbsp;именно: «Включен», «Запущен» и&nbsp;имя БД&nbsp;содержащей конфигурацию.
</li><li> Идентификатор, имя&nbsp;и&nbsp;описание контроллера.
</li><li> Состояние в&nbsp;которое переводить контроллер при&nbsp;загрузке: «Включен» и&nbsp;«Запущен».
</li><li> Имя&nbsp;таблицы для&nbsp;хранения параметров.
</li><li> Адрес вычислительной функции.
</li><li> Период, приоритет и&nbsp;число итераций в&nbsp;одном цикле задачи вычисления.
</li><li> Период автоматической синхронизации блоков с&nbsp;БД.
</li><li> Сохранить/загрузить контроллер в&nbsp;БД.</li></ul>
<br>
Вкладка «Вычисления» контроллера (Рис. 3) содержит параметры
и&nbsp;текст программы непосредственно выполняемой контроллером. Также,
для&nbsp;контроля выполнения, выводится время вычисления программы.<br>
<br>
<div style="text-align: center;"><img src="about_ru_files/wakka_003.jpeg" alt="Вкладка «Вычисления» контроллера. (68&nbsp;Кб)" title="Вкладка «Вычисления» контроллера. (68&nbsp;Кб)" height="544" width="702"><br>
Рис.3. Вкладка «Вычисления» контроллера.</div><br>
<a name="h101-10"></a><h2>3 Параметр контроллера и&nbsp;его конфигурация</h2>
Параметр контроллера данного модуля выполняет функцию предоставления
доступа к&nbsp;результатам вычисления контроллера в&nbsp;систему
OpenSCADA посредством атрибутов параметров. Из&nbsp;специфических
полей, вкладка конфигурации параметра контроллера содержит только поле
перечисления параметров вычисляемой функции, которые необходимо
отразить.<br>
<a name="h101-11"></a><h2>4 Библиотеки функций модуля</h2>
Модуль предоставляет механизм для&nbsp;создания библиотек
пользовательских функций на&nbsp;Java-подобном языке. Пример вкладки
конфигурации библиотеки изображен на&nbsp;Рис.4. Вкладка содержит
базовые поля: состояния, идентификатор, имя&nbsp;и&nbsp;описание,
а&nbsp;также адрес таблицы хранящей библиотеку. Во&nbsp;вкладке
«Функции» библиотеки, кроме перечня функций, содержится форма
копирования функций.<br>
<br>
<div style="text-align: center;"><img src="about_ru_files/wakka.jpeg" alt="Вкладка конфигурирования библиотеки. (76&nbsp;Кб)" title="Вкладка конфигурирования библиотеки. (76&nbsp;Кб)" height="592" width="756"><br>
Рис.4. Вкладка конфигурации библиотеки.</div><br>
<a name="h101-12"></a><h2>5 Пользовательские функции модуля</h2>
Функция, также как&nbsp;и&nbsp;библиотека, содержит базовую вкладку
конфигурации, вкладку формирования программы и&nbsp;параметров функции
(Рис.1), а&nbsp;также вкладку тестирования созданной функции.<br></div>
</body></html>